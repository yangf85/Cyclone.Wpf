<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:ctl="clr-namespace:Cyclone.Wpf.Controls">

    <ControlTemplate x:Key="MultiComboBoxItem.ControlTemplate.Basic" TargetType="{x:Type ctl:MultiComboBoxItem}">
        <Border x:Name="PART_ItemBorder"
                Padding="{TemplateBinding Padding}"
                Background="{TemplateBinding Background}"
                BorderThickness="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <CheckBox x:Name="PART_ItemCheckBox"
                          Grid.Column="0"
                          Margin="{StaticResource Margin.Right}"
                          VerticalAlignment="Center"
                          IsChecked="{Binding IsSelected, RelativeSource={RelativeSource TemplatedParent}}" />

                <ContentPresenter Grid.Column="1"
                                  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                  Content="{TemplateBinding Content}"
                                  ContentTemplate="{TemplateBinding ContentTemplate}" />
            </Grid>
        </Border>

        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="PART_ItemBorder" Property="Background" Value="{StaticResource Background.Hover}" />
            </Trigger>
            <Trigger Property="IsSelected" Value="True">
                <Setter TargetName="PART_ItemBorder" Property="Background" Value="{StaticResource Background.Checked}" />
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <Style x:Key="MultiComboBoxItem.Style.Basic" TargetType="{x:Type ctl:MultiComboBoxItem}">
        <Setter Property="Padding" Value="{StaticResource Padding.Horizontal}" />
        <Setter Property="Height" Value="{StaticResource Height.Horizontal.Item}" />
        <Setter Property="VerticalContentAlignment" Value="Center" />
        <Setter Property="HorizontalContentAlignment" Value="Left" />
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Margin" Value="0" />
        <Setter Property="Template" Value="{StaticResource MultiComboBoxItem.ControlTemplate.Basic}" />
    </Style>

    <ControlTemplate x:Key="MultiComboBox.ControlTemplate.Basic" TargetType="{x:Type ctl:MultiComboBox}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="0" />
            </Grid.RowDefinitions>

            <!--  Main Control  -->
            <Border x:Name="PART_Border"
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="{StaticResource CornerRadius.Medium}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!--  Text Display  -->
                    <TextBox x:Name="PART_EditableTextBox"
                             Grid.Column="0"
                             Padding="{TemplateBinding Padding}"
                             VerticalAlignment="Center"
                             HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                             VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                             Background="Transparent"
                             BorderThickness="0"
                             Foreground="{TemplateBinding Foreground}"
                             IsReadOnly="True"
                             Text="{TemplateBinding Text}" />

                    <!--  Toggle Button  -->
                    <ToggleButton x:Name="PART_ToggleButton"
                                  Grid.Column="1"
                                  Width="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"
                                  Padding="0"
                                  HorizontalContentAlignment="Center"
                                  VerticalContentAlignment="Center"
                                  Background="Transparent"
                                  BorderThickness="0"
                                  IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                        <Path x:Name="PART_ArrowPath"
                              Width="8"
                              Height="5"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              Data="M 0,0 L 8,0 L 4,5 Z"
                              Fill="{StaticResource Icon.Foreground.Default}" />
                    </ToggleButton>
                </Grid>
            </Border>

            <!--  Popup Content  -->
            <Popup x:Name="PART_Popup"
                   Grid.Row="1"
                   AllowsTransparency="True"
                   IsOpen="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}"
                   Placement="Bottom"
                   PlacementTarget="{Binding ElementName=PART_Border}"
                   PopupAnimation="Slide"
                   StaysOpen="False">
                <Border MinWidth="{Binding ActualWidth, ElementName=PART_Border}"
                        MaxHeight="{TemplateBinding MaxDropDownHeight}"
                        Background="{StaticResource Background.Container}"
                        BorderBrush="{StaticResource Border.Default}"
                        BorderThickness="{StaticResource BorderThickness.Thin}"
                        CornerRadius="{StaticResource CornerRadius.Medium}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <!--  Selection Control Buttons  -->
                        <Grid Grid.Row="0" Background="{StaticResource Background.Header}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Button x:Name="PART_SelectAllButton"
                                    Grid.Column="0"
                                    Height="{StaticResource Height.Horizontal.Item}"
                                    Margin="1"
                                    Background="{StaticResource Background.Default}"
                                    BorderBrush="{StaticResource Border.Default}"
                                    Command="{x:Static ctl:MultiComboBox.SelectAllCommand}"
                                    Content="全选"
                                    Foreground="{StaticResource Foreground.Default}" />

                            <Button x:Name="PART_UnselectAllButton"
                                    Grid.Column="1"
                                    Height="{StaticResource Height.Horizontal.Item}"
                                    Margin="1"
                                    Background="{StaticResource Background.Default}"
                                    BorderBrush="{StaticResource Border.Default}"
                                    Command="{x:Static ctl:MultiComboBox.UnselectAllCommand}"
                                    Content="取消全选"
                                    Foreground="{StaticResource Foreground.Default}" />

                            <Button x:Name="PART_InvertSelectionButton"
                                    Grid.Column="2"
                                    Height="{StaticResource Height.Horizontal.Item}"
                                    Margin="1"
                                    Background="{StaticResource Background.Default}"
                                    BorderBrush="{StaticResource Border.Default}"
                                    Command="{x:Static ctl:MultiComboBox.InvertSelectionCommand}"
                                    Content="反选"
                                    Foreground="{StaticResource Foreground.Default}" />
                        </Grid>

                        <!--  Items List  -->
                        <ScrollViewer Grid.Row="1"
                                      MaxHeight="{TemplateBinding MaxDropDownHeight}"
                                      Margin="0,1,0,0"
                                      VerticalScrollBarVisibility="Auto">
                            <ItemsPresenter x:Name="PART_ItemsPresenter" />
                        </ScrollViewer>
                    </Grid>
                </Border>
            </Popup>
        </Grid>

        <ControlTemplate.Triggers>
            <!--  Focus Visual States  -->
            <Trigger Property="IsKeyboardFocused" Value="True">
                <Setter TargetName="PART_Border" Property="BorderBrush" Value="{StaticResource Border.Focused}" />
            </Trigger>

            <!--  Hover Visual States  -->
            <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="PART_Border" Property="Background" Value="{StaticResource Background.Hover}" />
            </Trigger>

            <!--  Dropdown Open Visual States  -->
            <Trigger Property="IsDropDownOpen" Value="True">
                <Setter TargetName="PART_ArrowPath" Property="Fill" Value="{StaticResource Icon.Foreground.Focused}" />
                <Setter TargetName="PART_Border" Property="BorderBrush" Value="{StaticResource Border.Active}" />
            </Trigger>

            <!--  Disabled Visual State  -->
            <Trigger Property="IsEnabled" Value="False">
                <Setter TargetName="PART_Border" Property="Background" Value="{StaticResource Background.Disabled}" />
                <Setter TargetName="PART_Border" Property="BorderBrush" Value="{StaticResource Border.Disabled}" />
                <Setter TargetName="PART_EditableTextBox" Property="Foreground" Value="{StaticResource Foreground.Disabled}" />
                <Setter TargetName="PART_ArrowPath" Property="Fill" Value="{StaticResource Icon.Foreground.Disabled}" />
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <Style TargetType="{x:Type ctl:MultiComboBox}">
        <Setter Property="Background" Value="{StaticResource Background.Default}" />
        <Setter Property="Foreground" Value="{StaticResource Foreground.Default}" />
        <Setter Property="BorderBrush" Value="{StaticResource Border.Default}" />
        <Setter Property="BorderThickness" Value="{StaticResource BorderThickness.Thin}" />
        <Setter Property="Padding" Value="{StaticResource Padding.Horizontal}" />
        <Setter Property="VerticalContentAlignment" Value="Center" />
        <Setter Property="HorizontalContentAlignment" Value="Left" />
        <Setter Property="Height" Value="{StaticResource Height.Horizontal.Control}" />
        <Setter Property="FontSize" Value="{StaticResource Font.Input}" />
        <Setter Property="Focusable" Value="True" />
        <Setter Property="Template" Value="{StaticResource MultiComboBox.ControlTemplate.Basic}" />
        <!--<Setter Property="ItemContainerStyle" Value="{StaticResource MultiComboBoxItem.Style.Basic}" />-->
        <!--<Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>-->
    </Style>
</ResourceDictionary>